<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Badminton Tournament Generator</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            margin: 0;
            color: #333;
            font-size: 32px;
        }
        
        .header p {
            margin: 10px 0 0 0;
            color: #666;
            font-size: 16px;
        }
        
        .form-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .form-section h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="date"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .teams-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .team-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: border-color 0.3s;
        }
        
        .team-card:hover {
            border-color: #667eea;
        }
        
        .team-card h4 {
            margin: 0 0 12px 0;
            color: #667eea;
            font-size: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .player-input {
            margin-bottom: 8px;
        }
        
        .player-input input {
            font-size: 13px;
            padding: 8px 10px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
            width: 100%;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .schedule-output {
            display: none;
        }
        
        .action-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .schedule-wrapper {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #667eea;
        }
        
        .schedule-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }
        
        .schedule-header h2 {
            margin: 0;
            font-size: 20px;
            color: #333;
        }
        
        .schedule-header p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 14px;
        }
        
        .teams-legend {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .teams-legend h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 14px;
        }
        
        .team-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px;
        }
        
        .team-item {
            background: white;
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }
        
        .team-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
            font-size: 13px;
        }
        
        .players {
            font-size: 11px;
            color: #666;
        }
        
        .round-section {
            margin-bottom: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            page-break-inside: avoid;
        }
        
        .round-title {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 8px;
            color: #667eea;
            padding-bottom: 5px;
            border-bottom: 2px solid #ddd;
        }
        
        .courts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }
        
        .court-card {
            background: white;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .court-header {
            font-weight: bold;
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 2px solid #667eea;
            color: #333;
            font-size: 11px;
        }
        
        .game-row {
            padding: 6px;
            margin-bottom: 5px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .game-number {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 4px;
            font-size: 10px;
        }
        
        .matchup {
            margin-bottom: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .vs {
            font-weight: bold;
            color: #666;
            margin: 0 6px;
        }
        
        .score-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
        }
        
        .score-inputs input {
            width: 45px;
            padding: 4px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .score-inputs input:focus {
            border-color: #667eea;
        }
        
        .results-section {
            margin-top: 20px;
            padding: 20px;
            background: #d4edda;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            display: none;
        }
        
        .results-section h3 {
            margin: 0 0 15px 0;
            color: #155724;
        }
        
        .result-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 3px solid #28a745;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .info-box strong {
            color: #1976D2;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 5px;
                max-width: 100%;
            }
            
            .action-bar,
            .results-section,
            .header {
                display: none !important;
            }
            
            .schedule-wrapper {
                border: none;
                padding: 0;
            }
            
            .schedule-header {
                display: none !important;
            }
            
            .teams-legend {
                padding: 5px;
                margin-bottom: 8px;
                font-size: 10px;
            }
            
            .teams-legend h4 {
                font-size: 11px;
                margin-bottom: 5px;
            }
            
            .team-list {
                gap: 5px;
            }
            
            .team-item {
                padding: 4px 6px;
            }
            
            .team-name {
                font-size: 11px;
            }
            
            .players {
                font-size: 9px;
            }
            
            .round-section {
                margin-bottom: 8px;
                padding: 6px;
                page-break-inside: avoid;
            }
            
            .round-title {
                font-size: 11px;
                margin-bottom: 5px;
                padding-bottom: 3px;
            }
            
            .courts-grid {
                gap: 6px;
                grid-template-columns: repeat(3, 1fr);
            }
            
            .court-card {
                padding: 5px;
            }
            
            .court-header {
                font-size: 9px;
                margin-bottom: 4px;
                padding-bottom: 2px;
            }
            
            .game-row {
                padding: 4px;
                margin-bottom: 3px;
            }
            
            .game-number {
                font-size: 8px;
                margin-bottom: 2px;
            }
            
            .matchup {
                font-size: 12px;
                margin-bottom: 4px;
                line-height: 1.2;
            }
            
            .score-inputs {
                font-size: 9px;
                gap: 4px;
            }
            
            .score-inputs input {
                width: 35px;
                padding: 2px;
                font-size: 9px;
            }
            
            .round-section:nth-child(7) {
                page-break-before: always;
            }
        }
    </style>

    <script>
      
      const files = {
        
      }
    


      window.fs = {}
      window.fs.readFile = (fileName) => {
        // return array buffer
        return new Promise((resolve) => {
          const content = files[fileName]
          const decoded = atob(content)
          const arr = new Uint8Array(decoded.length)
          for (let i = 0; i < decoded.length; i++) {
            arr[i] = decoded.charCodeAt(i)
          }
          resolve(arr)
        })
      }

      // stub out window.user.get, window.db.get and window.db.set so that it works when you download the html doc
      window.db = {}
      window.db.get = (key) => {
        // use localStorage to store the artifact
        const value = localStorage.getItem(key)
        if (value) {
          return JSON.parse(value)
        }

        return null
      }

      window.db.set = (key, value) => {
        // use localStorage to store the artifact
        localStorage.setItem(key, JSON.stringify(value))
      }

      window.user = {}
      window.user.get = () => {
        return {
          userId: "user-id-placeholder",
          email: "placeholder@test.com"
        }
      }

    </script>
    </head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∏ Badminton Tournament Generator</h1>
            <p>Create optimized tournament schedules with fair play distribution</p>
        </div>
        
        <div id="form-section">
            <div class="form-section">
                <h3>üìÖ Tournament Configuration</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label for="tournament-date">Tournament Date:</label>
                        <input type="date" id="tournament-date">
                    </div>
                    <div class="form-group">
                        <label for="num-teams">Number of Teams:</label>
                        <select id="num-teams">
                            <option value="">Select...</option>
                            <option value="3">3 Teams</option>
                            <option value="4">4 Teams</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="players-per-team">Players per Team:</label>
                        <select id="players-per-team">
                            <option value="">Select...</option>
                            <option value="3">3 Players</option>
                            <option value="6">6 Players</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="num-courts">Number of Courts:</label>
                        <input type="number" id="num-courts" min="1" max="10" placeholder="e.g., 2">
                    </div>
                </div>
                
                <div class="info-box" id="config-info" style="display: none;">
                    <strong>Configuration:</strong> <span id="config-text"></span>
                </div>
            </div>
            
            <div class="form-section" id="courts-section" style="display: none;">
                <h3>üèüÔ∏è Court Names</h3>
                <div id="courts-container"></div>
            </div>
            
            <div class="form-section" id="teams-section" style="display: none;">
                <h3>üë• Team & Player Information</h3>
                <div id="teams-container" class="teams-container"></div>
            </div>
            
            <button class="btn btn-primary" id="generate-btn" style="display: none;">
                üéØ Generate Tournament Schedule
            </button>
        </div>
        
        <div id="schedule-output" class="schedule-output">
            <div class="action-bar">
                <button class="btn btn-secondary" id="back-btn">‚Üê Back</button>
                <button class="btn btn-info" id="calculate-btn">üèÜ Calculate Results</button>
                <button class="btn btn-danger" id="clear-btn">üóëÔ∏è Clear Scores</button>
                <button class="btn btn-success" id="download-btn">üì• Download</button>
            </div>
            
            <div class="schedule-wrapper">
                <div id="generated-schedule"></div>
            </div>
            
            <div id="results-section" class="results-section">
                <h3>üèÜ Tournament Results</h3>
                <div id="results-content"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('tournament-date').value = new Date().toISOString().split('T')[0];
        
        let currentConfig = null;
        let gameData = [];
        
        document.getElementById('num-teams').addEventListener('change', updateConfiguration);
        document.getElementById('players-per-team').addEventListener('change', updateConfiguration);
        document.getElementById('num-courts').addEventListener('input', updateConfiguration);
        document.getElementById('generate-btn').addEventListener('click', generateSchedule);
        
        document.getElementById('back-btn').addEventListener('click', () => {
            if (confirm('Going back will lose all entered data. Continue?')) {
                showForm();
            }
        });
        document.getElementById('calculate-btn').addEventListener('click', calculateResults);
        document.getElementById('clear-btn').addEventListener('click', clearScores);
        document.getElementById('download-btn').addEventListener('click', downloadSchedule);
        
        function updateConfiguration() {
            const numTeams = parseInt(document.getElementById('num-teams').value);
            const playersPerTeam = parseInt(document.getElementById('players-per-team').value);
            const numCourts = parseInt(document.getElementById('num-courts').value);
            
            if (!numTeams || !playersPerTeam) {
                document.getElementById('config-info').style.display = 'none';
                document.getElementById('courts-section').style.display = 'none';
                document.getElementById('teams-section').style.display = 'none';
                document.getElementById('generate-btn').style.display = 'none';
                return;
            }
            
            const totalPlayers = numTeams * playersPerTeam;
            let maxGames = 0;
            let gamesPerPlayer = 0;
            
            if (totalPlayers === 12 && numTeams === 4 && playersPerTeam === 3) {
                maxGames = 18;
                gamesPerPlayer = 6;
            } else if (totalPlayers === 18 && numTeams === 3 && playersPerTeam === 6) {
                maxGames = 27;
                gamesPerPlayer = 6;
            }
            
            document.getElementById('config-info').style.display = 'block';
            document.getElementById('config-text').textContent = 
                `${totalPlayers} total players (${numTeams} teams √ó ${playersPerTeam} players) - Target: ${maxGames} games, ${gamesPerPlayer} games per player`;
            
            if (numCourts > 0) {
                generateCourtInputs(numCourts);
            }
            
            generateTeamInputs(numTeams, playersPerTeam);
            
            document.getElementById('generate-btn').style.display = 'block';
        }
        
        function generateCourtInputs(numCourts) {
            const container = document.getElementById('courts-container');
            container.innerHTML = '';
            
            const grid = document.createElement('div');
            grid.className = 'config-grid';
            
            for (let i = 1; i <= numCourts; i++) {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label for="court-${i}">Court ${i} Name:</label>
                    <input type="text" id="court-${i}" placeholder="Court ${i}" value="Court ${i}">
                `;
                grid.appendChild(div);
            }
            
            container.appendChild(grid);
            document.getElementById('courts-section').style.display = 'block';
        }
        
        function generateTeamInputs(numTeams, playersPerTeam) {
            const container = document.getElementById('teams-container');
            container.innerHTML = '';
            
            for (let t = 1; t <= numTeams; t++) {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                
                let html = `
                    <h4>Team ${t}</h4>
                    <div class="form-group">
                        <label>Team Name:</label>
                        <input type="text" id="team-${t}-name" placeholder="Team ${t} Name">
                    </div>
                `;
                
                for (let p = 1; p <= playersPerTeam; p++) {
                    html += `
                        <div class="player-input">
                            <label>Player ${p}:</label>
                            <input type="text" id="team-${t}-player-${p}" placeholder="Player ${p} Name">
                        </div>
                    `;
                }
                
                teamCard.innerHTML = html;
                container.appendChild(teamCard);
            }
            
            document.getElementById('teams-section').style.display = 'block';
        }
        
        function validateInputs() {
            const numTeams = parseInt(document.getElementById('num-teams').value);
            const playersPerTeam = parseInt(document.getElementById('players-per-team').value);
            const numCourts = parseInt(document.getElementById('num-courts').value);
            const date = document.getElementById('tournament-date').value;
            
            if (!date) {
                alert('Please select a tournament date');
                return false;
            }
            
            if (!numCourts || numCourts < 1) {
                alert('Please enter number of courts');
                return false;
            }
            
            for (let i = 1; i <= numCourts; i++) {
                const court = document.getElementById(`court-${i}`).value.trim();
                if (!court) {
                    alert(`Please enter name for Court ${i}`);
                    return false;
                }
            }
            
            for (let t = 1; t <= numTeams; t++) {
                const teamName = document.getElementById(`team-${t}-name`).value.trim();
                if (!teamName) {
                    alert(`Please enter name for Team ${t}`);
                    return false;
                }
                
                for (let p = 1; p <= playersPerTeam; p++) {
                    const playerName = document.getElementById(`team-${t}-player-${p}`).value.trim();
                    if (!playerName) {
                        alert(`Please enter name for Team ${t}, Player ${p}`);
                        return false;
                    }
                }
            }
            
            return true;
        }
        
        function generateSchedule() {
            if (!validateInputs()) return;
            
            const numTeams = parseInt(document.getElementById('num-teams').value);
            const playersPerTeam = parseInt(document.getElementById('players-per-team').value);
            const numCourts = parseInt(document.getElementById('num-courts').value);
            const date = document.getElementById('tournament-date').value;
            
            const courts = [];
            for (let i = 1; i <= numCourts; i++) {
                courts.push(document.getElementById(`court-${i}`).value.trim());
            }
            
            const teams = [];
            for (let t = 1; t <= numTeams; t++) {
                const team = {
                    name: document.getElementById(`team-${t}-name`).value.trim(),
                    players: []
                };
                
                for (let p = 1; p <= playersPerTeam; p++) {
                    team.players.push(document.getElementById(`team-${t}-player-${p}`).value.trim());
                }
                
                teams.push(team);
            }
            
            currentConfig = { date, courts, teams, numTeams, playersPerTeam };
            
            let scheduleHTML;
            if (numTeams === 4 && playersPerTeam === 3) {
                scheduleHTML = generate12PlayerSchedule(currentConfig);
            } else if (numTeams === 3 && playersPerTeam === 6) {
                scheduleHTML = generate18PlayerSchedule(currentConfig);
            } else {
                alert('This configuration is not yet supported. Please use 4 teams of 3 or 3 teams of 6.');
                return;
            }
            
            document.getElementById('generated-schedule').innerHTML = scheduleHTML;
            document.getElementById('form-section').style.display = 'none';
            document.getElementById('schedule-output').style.display = 'block';
            document.getElementById('results-section').style.display = 'none';
            
            addScoreListeners();
        }
        
        function generate12PlayerSchedule(config) {
            const { date, courts, teams } = config;
            gameData = [];
            
            const rivalries = [];
            for (let i = 0; i < teams.length; i++) {
                for (let j = i + 1; j < teams.length; j++) {
                    rivalries.push([i, j]);
                }
            }
            
            let gameNum = 1;
            let html = `
                <div class="schedule-header">
                    <h2>üè∏ Badminton Tournament</h2>
                    <p>${new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>
                
                <div class="teams-legend">
                    <h4>Team Rosters</h4>
                    <div class="team-list">
                        ${teams.map(t => `
                            <div class="team-item">
                                <div class="team-name">${t.name}</div>
                                <div class="players">${t.players.join(', ')}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            const gamesPerRound = courts.length;
            const totalGames = rivalries.length * 3;
            const numRounds = Math.ceil(totalGames / gamesPerRound);
            
            let allGames = [];
            rivalries.forEach(([t1, t2]) => {
                const team1 = teams[t1];
                const team2 = teams[t2];
                
                const pairs1 = [
                    [team1.players[0], team1.players[1]],
                    [team1.players[0], team1.players[2]],
                    [team1.players[1], team1.players[2]]
                ];
                
                const pairs2 = [
                    [team2.players[0], team2.players[1]],
                    [team2.players[0], team2.players[2]],
                    [team2.players[1], team2.players[2]]
                ];
                
                for (let i = 0; i < 3; i++) {
                    allGames.push({
                        team1Name: team1.name,
                        team2Name: team2.name,
                        team1Pair: pairs1[i],
                        team2Pair: pairs2[i]
                    });
                }
            });
            
            for (let round = 0; round < numRounds; round++) {
                html += `<div class="round-section">
                    <div class="round-title">Round ${round + 1}</div>
                    <div class="courts-grid">`;
                
                for (let court = 0; court < gamesPerRound; court++) {
                    const gameIndex = round * gamesPerRound + court;
                    if (gameIndex >= allGames.length) break;
                    
                    const game = allGames[gameIndex];
                    const courtName = courts[court % courts.length];
                    
                    gameData.push(game);
                    
                    html += `
                        <div class="court-card">
                            <div class="court-header">${courtName}: ${game.team1Name} vs ${game.team2Name}</div>
                            <div class="game-row">
                                <div class="game-number">Game ${gameNum}</div>
                                <div class="matchup">
                                    ${game.team1Pair[0]} & ${game.team1Pair[1]}
                                    <span class="vs">vs</span>
                                    ${game.team2Pair[0]} & ${game.team2Pair[1]}
                                </div>
                                <div class="score-inputs">
                                    <span>Score:</span>
                                    <input type="number" id="game-${gameNum}-s1" min="0" max="99" placeholder="0">
                                    <span>-</span>
                                    <input type="number" id="game-${gameNum}-s2" min="0" max="99" placeholder="0">
                                </div>
                            </div>
                        </div>
                    `;
                    
                    gameNum++;
                }
                
                html += `</div></div>`;
            }
            
            return html;
        }
        
        function generate18PlayerSchedule(config) {
            const { date, courts, teams } = config;
            gameData = [];
            
            let gameNum = 1;
            let html = `
                <div class="schedule-header">
                    <h2>üè∏ Badminton Tournament</h2>
                    <p>${new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>
                
                <div class="teams-legend">
                    <h4>Team Rosters</h4>
                    <div class="team-list">
                        ${teams.map(t => `
                            <div class="team-item">
                                <div class="team-name">${t.name}</div>
                                <div class="players">${t.players.join(', ')}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            const pairingSchedule = [
    { rivalry: 0, t1: [0,1], t2: [0,1] },  // Game 1
    { rivalry: 1, t1: [2,3], t2: [2,3] },  // Game 2
    { rivalry: 2, t1: [4,3], t2: [4,5] },  // Game 3
    { rivalry: 1, t1: [0,1], t2: [4,0] },  // Game 4
    { rivalry: 0, t1: [4,5], t2: [4,5] },  // Game 5
    { rivalry: 2, t1: [2,3], t2: [1,2] },  // Game 6
    { rivalry: 0, t1: [2,5], t2: [2,1] },  // Game 7
    { rivalry: 1, t1: [4,3], t2: [3,1] },  // Game 8
    { rivalry: 2, t1: [0,5], t2: [0,5] },  // Game 9
    { rivalry: 1, t1: [2,3], t2: [2,5] },  // Game 10
    { rivalry: 2, t1: [1,3], t2: [4,3] },  // Game 11
    { rivalry: 0, t1: [0,1], t2: [0,4] },  // Game 12
    { rivalry: 0, t1: [5,4], t2: [5,3] },  // Game 13
    { rivalry: 1, t1: [0,1], t2: [4,0] },  // Game 14
    { rivalry: 2, t1: [2,4], t2: [1,2] },  // Game 15
    { rivalry: 0, t1: [3,5], t2: [2,0] },  // Game 16
    { rivalry: 1, t1: [2,4], t2: [3,5] },  // Game 17
    { rivalry: 2, t1: [1,5], t2: [1,0] },  // Game 18
    { rivalry: 0, t1: [0,2], t2: [0,4] },  // Game 19
    { rivalry: 1, t1: [3,1], t2: [3,4] },  // Game 20
    { rivalry: 2, t1: [1,3], t2: [5,2] },  // Game 21
    { rivalry: 0, t1: [0,4], t2: [4,2] },  // Game 22
    { rivalry: 1, t1: [5,1], t2: [4,1] },  // Game 23
    { rivalry: 2, t1: [5,3], t2: [0,2] },  // Game 24
    { rivalry: 2, t1: [3,1], t2: [5,0] },  // Game 25
    { rivalry: 0, t1: [3,2], t2: [1,2] },  // Game 26
    { rivalry: 1, t1: [5,4], t2: [0,5] },  // Game 27
];
            
            const rivalries = [
                [0, 1],
                [0, 2],
                [1, 2]
            ];
            
            let allGames = [];
            
            pairingSchedule.forEach(schedule => {
                const [t1Idx, t2Idx] = rivalries[schedule.rivalry];
                const team1 = teams[t1Idx];
                const team2 = teams[t2Idx];
                
                allGames.push({
                    team1Name: team1.name,
                    team2Name: team2.name,
                    team1Pair: [team1.players[schedule.t1[0]], team1.players[schedule.t1[1]]],
                    team2Pair: [team2.players[schedule.t2[0]], team2.players[schedule.t2[1]]]
                });
            });
            
            const gamesPerRound = 3;
            const numRounds = 9;
            
            for (let round = 0; round < numRounds; round++) {
                html += `<div class="round-section">
                    <div class="round-title">Round ${round + 1}</div>
                    <div class="courts-grid">`;
                
                for (let court = 0; court < gamesPerRound; court++) {
                    const gameIndex = round * gamesPerRound + court;
                    if (gameIndex >= allGames.length) break;
                    
                    const game = allGames[gameIndex];
                    const courtName = courts[court % courts.length];
                    
                    gameData.push(game);
                    
                    html += `
                        <div class="court-card">
                            <div class="court-header">${courtName}: ${game.team1Name} vs ${game.team2Name}</div>
                            <div class="game-row">
                                <div class="game-number">Game ${gameNum}</div>
                                <div class="matchup">
                                    ${game.team1Pair[0]} & ${game.team1Pair[1]}
                                    <span class="vs">vs</span>
                                    ${game.team2Pair[0]} & ${game.team2Pair[1]}
                                </div>
                                <div class="score-inputs">
                                    <span>Score:</span>
                                    <input type="number" id="game-${gameNum}-s1" min="0" max="99" placeholder="0">
                                    <span>-</span>
                                    <input type="number" id="game-${gameNum}-s2" min="0" max="99" placeholder="0">
                                </div>
                            </div>
                        </div>
                    `;
                    
                    gameNum++;
                }
                
                html += `</div></div>`;
            }
            
            return html;
        }
        
        function addScoreListeners() {
            for (let i = 1; i <= gameData.length; i++) {
                const s1 = document.getElementById(`game-${i}-s1`);
                const s2 = document.getElementById(`game-${i}-s2`);
                if (s1 && s2) {
                    s1.addEventListener('input', () => {
                        s1.style.background = s1.value ? '#e8f5e9' : '';
                    });
                    s2.addEventListener('input', () => {
                        s2.style.background = s2.value ? '#e8f5e9' : '';
                    });
                }
            }
        }
        
        function calculateResults() {
            const teamStats = {};
            const pairStats = {};
            const playerStats = {};
            
            currentConfig.teams.forEach(team => {
                teamStats[team.name] = { wins: 0, losses: 0, pf: 0, pa: 0 };
                team.players.forEach(player => {
                    playerStats[player] = { games: 0, wins: 0, losses: 0, team: team.name };
                });
            });
            
            let gamesPlayed = 0;
            
            for (let i = 1; i <= gameData.length; i++) {
                const s1 = document.getElementById(`game-${i}-s1`);
                const s2 = document.getElementById(`game-${i}-s2`);
                
                if (s1?.value && s2?.value) {
                    gamesPlayed++;
                    const score1 = parseInt(s1.value);
                    const score2 = parseInt(s2.value);
                    const game = gameData[i - 1];
                    
                    const team1Won = score1 > score2;
                    
                    if (team1Won) {
                        teamStats[game.team1Name].wins++;
                        teamStats[game.team2Name].losses++;
                    } else {
                        teamStats[game.team2Name].wins++;
                        teamStats[game.team1Name].losses++;
                    }
                    
                    teamStats[game.team1Name].pf += score1;
                    teamStats[game.team1Name].pa += score2;
                    teamStats[game.team2Name].pf += score2;
                    teamStats[game.team2Name].pa += score1;
                    
                    game.team1Pair.forEach(player => {
                        playerStats[player].games++;
                        if (team1Won) playerStats[player].wins++;
                        else playerStats[player].losses++;
                    });
                    
                    game.team2Pair.forEach(player => {
                        playerStats[player].games++;
                        if (!team1Won) playerStats[player].wins++;
                        else playerStats[player].losses++;
                    });
                    
                    const pair1 = `${game.team1Pair[0]} & ${game.team1Pair[1]}`;
                    const pair2 = `${game.team2Pair[0]} & ${game.team2Pair[1]}`;
                    
                    if (!pairStats[pair1]) pairStats[pair1] = { wins: 0, losses: 0, pf: 0, pa: 0, team: game.team1Name };
                    if (!pairStats[pair2]) pairStats[pair2] = { wins: 0, losses: 0, pf: 0, pa: 0, team: game.team2Name };
                    
                    if (team1Won) {
                        pairStats[pair1].wins++;
                        pairStats[pair2].losses++;
                    } else {
                        pairStats[pair2].wins++;
                        pairStats[pair1].losses++;
                    }
                    
                    pairStats[pair1].pf += score1;
                    pairStats[pair1].pa += score2;
                    pairStats[pair2].pf += score2;
                    pairStats[pair2].pa += score1;
                }
            }
            
            if (gamesPlayed === 0) {
                alert('Please enter scores for at least one game!');
                return;
            }
            
            const teamResults = Object.entries(teamStats)
                .map(([name, stats]) => ({ name, ...stats, diff: stats.pf - stats.pa }))
                .sort((a, b) => b.wins - a.wins || b.diff - a.diff);
            
            const pairResults = Object.entries(pairStats)
                .map(([pair, stats]) => ({ pair, ...stats, diff: stats.pf - stats.pa }))
                .sort((a, b) => b.wins - a.wins || b.diff - a.diff);
            
            const playerResults = Object.entries(playerStats)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.games - a.games || b.wins - a.wins);
            
            let html = `
                <div class="result-item">
                    <strong>üìä Games Completed:</strong> ${gamesPlayed} of ${gameData.length}
                </div>
                
                <div class="result-item">
                    <strong>üèÜ Current Leader:</strong> ${teamResults[0].name} 
                    (${teamResults[0].wins}W-${teamResults[0].losses}L, ${teamResults[0].diff > 0 ? '+' : ''}${teamResults[0].diff} differential)
                </div>
                
                <div class="result-item">
                    <strong>üìä Team Standings:</strong><br>
                    ${teamResults.map((t, i) => 
                        `${i + 1}. ${t.name}: ${t.wins}W-${t.losses}L, ${t.diff > 0 ? '+' : ''}${t.diff} diff (${t.pf} PF, ${t.pa} PA)`
                    ).join('<br>')}
                </div>
                
                <div class="result-item">
                    <strong>üë§ Player Statistics:</strong><br>
                    ${playerResults.map(p => 
                        `${p.name} (${p.team}): ${p.games} games, ${p.wins}W-${p.losses}L`
                    ).join('<br>')}
                </div>
                
                <div class="result-item">
                    <strong>‚≠ê Top Pairs:</strong><br>
                    ${pairResults.slice(0, 3).map((p, i) => 
                        `${i + 1}. ${p.pair} (${p.team}): ${p.wins}W-${p.losses}L, ${p.diff > 0 ? '+' : ''}${p.diff} diff`
                    ).join('<br>')}
                </div>
            `;
            
            document.getElementById('results-content').innerHTML = html;
            document.getElementById('results-section').style.display = 'block';
            document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        function clearScores() {
            if (confirm('Clear all scores?')) {
                for (let i = 1; i <= gameData.length; i++) {
                    const s1 = document.getElementById(`game-${i}-s1`);
                    const s2 = document.getElementById(`game-${i}-s2`);
                    if (s1 && s2) {
                        s1.value = '';
                        s2.value = '';
                        s1.style.background = '';
                        s2.style.background = '';
                    }
                }
                document.getElementById('results-section').style.display = 'none';
            }
        }
        
        function showForm() {
            document.getElementById('form-section').style.display = 'block';
            document.getElementById('schedule-output').style.display = 'none';
        }
        
        function downloadSchedule() {
            const scheduleContent = document.getElementById('generated-schedule').innerHTML;
            
            const html = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Badminton Tournament</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 10px; margin: 0; }
        .schedule-header { display: none; }
        .teams-legend { background: #f5f5f5; padding: 5px; margin-bottom: 8px; border-radius: 5px; font-size: 10px; }
        .team-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .team-item { background: white; padding: 4px 6px; border-left: 3px solid #667eea; border-radius: 4px; }
        .team-name { font-weight: bold; font-size: 11px; }
        .players { font-size: 9px; color: #666; }
        .round-section { margin-bottom: 8px; padding: 6px; background: #f8f9fa; border-radius: 8px; page-break-inside: avoid; }
        .round-title { font-weight: bold; margin-bottom: 5px; color: #667eea; font-size: 11px; padding-bottom: 3px; border-bottom: 2px solid #ddd; }
        .courts-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .court-card { background: white; padding: 5px; border: 1px solid #ddd; border-radius: 6px; }
        .court-header { font-weight: bold; margin-bottom: 4px; border-bottom: 2px solid #667eea; padding-bottom: 2px; font-size: 9px; }
        .game-row { padding: 4px; margin-bottom: 3px; border: 1px solid #e0e0e0; border-radius: 6px; }
        .game-number { font-weight: bold; color: #667eea; margin-bottom: 2px; font-size: 8px; }
        .matchup { margin-bottom: 4px; font-size: 12px; font-weight: 600; line-height: 1.2; }
        .vs { font-weight: bold; margin: 0 6px; }
        .score-inputs { display: flex; gap: 4px; align-items: center; font-size: 9px; }
        .score-inputs input { width: 35px; padding: 2px; text-align: center; border: 2px solid #ddd; border-radius: 4px; font-size: 9px; }
        .round-section:nth-child(7) { page-break-before: always; }
    </style>
</head>
<body>
    ${scheduleContent}
</body>
</html>`;

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `badminton-tournament-${currentConfig.date}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
